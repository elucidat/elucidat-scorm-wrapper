var Debug_API=function Debug_API(){};Debug_API.prototype.Initialize=function(){return console.log(" \u2514 Debug_api:Initialize"),!0},Debug_API.prototype.Terminate=function(){return console.log(" \u2514 Debug_api:Terminate"),!0},Debug_API.prototype.GetValue=function(){return""},Debug_API.prototype.SetValue=function(a,b){return console.log(" \u250C Debug_api:SetValue: "+a+"="+b),""},Debug_API.prototype.Commit=function(){return console.log(" \u2514 Debug_api:Commit"),!0},Debug_API.prototype.GetLastError=function(){return 0},Debug_API.prototype.GetErrorString=function(){return""},Debug_API.prototype.GetDiagnostic=function(){return""},Debug_API.prototype.LMSInitialize=function(){return console.log(" \u2514 Debug_api:LMSInitialize"),!0},Debug_API.prototype.LMSFinish=function(){return console.log(" \u2514 Debug_api:LMSFinish"),!0},Debug_API.prototype.LMSGetValue=function(){return""},Debug_API.prototype.LMSSetValue=function(a,b){return console.log(" \u250C Debug_api:LMSSetValue: "+a+"="+b),""},Debug_API.prototype.LMSCommit=function(){return console.log(" \u2514 Debug_api:Commit"),!0},Debug_API.prototype.LMSGetLastError=function(){return 0},Debug_API.prototype.LMSGetErrorString=function(){return""},Debug_API.prototype.LMSGetDiagnostic=function(){return""};var Scorm=function Scorm(a){this.options=$.extend({},{debug_mode:"2004"},a),this.scorm_interface=null,this.mode=null,this.active=!1,this.objectives=[],this.interactions=[],this.start_time=new Date().getTime(),this.has_score=!1,this.is_debug=!1,this._search_for_api(window),null==this.scorm_interface?(this.mode=this.options.debug_mode,this.is_debug=!0,console.log("LMS not present - Created SCORM "+this.mode+" Debug interface."),this.scorm_interface=new Debug_API):(this.mode="LMSCommit"in this.scorm_interface?"1.2":"2004",console.log("Found SCORM "+this.mode+" interface."))};Scorm.prototype._format_time=function(a){var b=Math.floor,c=Math.round;function pad(a,b){var d="0000"+new String(c(a));return d.substr(d.length-b)}a/=1e3;var d=b(a/3600);a-=3600*d;var e=b(a/60),a=a-60*e;return"2004"==this.mode?"PT"+(d?d+"H":"")+(e?e+"M":"")+c(a)+"S":pad(d,2)+":"+pad(e,2)+":"+pad(a,2)},Scorm.prototype._search_for_api=function(a,b,c){function searchTree(a){try{for(;null!=a&&null==d.scorm_interface;){if(a.API)return void(d.scorm_interface=a.API);if(a.API_1484_11)return void(d.scorm_interface=a.API_1484_11);null==a.opener||a.opener.closed||searchTree(a.opener),a=a===a.parent?null:a.parent}}catch(a){console.error("Error searching for SCORM API:",a)}}b="undefined"==typeof b?10:b,c="undefined"==typeof c?500:c;var d=this;(function tryFindAPI(){searchTree(a),null==d.scorm_interface&&0<b?setTimeout(function(){d._search_for_api(a,b-1,c)},c):null==d.scorm_interface&&console.warn("SCORM API not found after maximum retries.")})()},Scorm.prototype.Check=function(){var a=0,b="";return"2004"==this.mode?(a=parseInt(this.scorm_interface.GetLastError()),a&&(b="Error ("+a+"): "+this.scorm_interface.GetErrorString(a))):"1.2"==this.mode&&(a=parseInt(this.scorm_interface.LMSGetLastError()),a&&(b="Error ("+a+"): "+this.scorm_interface.LMSGetErrorString(a))),{code:a,description:b}},Scorm.prototype.Initialize=function(){console.log("Scorm:Initialize"),"2004"==this.mode?this.scorm_interface.Initialize(""):"1.2"==this.mode&&this.scorm_interface.LMSInitialize(""),0==this.Check().code&&(this.active=!0);var a=this.GetCompletionStatus();return a&&"not attempted"!=a&&"unknown"!=a||(this.SetIncomplete(),this.SetExit("suspend")),this.active},Scorm.prototype.Terminate=function(){console.log("Scorm:Terminate"),"2004"==this.mode?this.scorm_interface.Terminate(""):"1.2"==this.mode&&this.scorm_interface.LMSFinish(""),0==this.Check().code&&(this.active=!1)},Scorm.prototype.Deactivate=function(){console.log("Scorm:Deactivate"),this.active=!1},Scorm.prototype.SetValue=function(a,b,c){if(this.active){var d;"2004"==this.mode?(this.scorm_interface.SetValue(a,b),!c&&(d=this.scorm_interface.GetValue(a))):"1.2"==this.mode&&(this.scorm_interface.LMSSetValue(a,b),!c&&(d=this.scorm_interface.LMSGetValue(a))),top.postMessage&&top.postMessage(a+"="+b,"*");var e=this.Check(),f="Scorm:SetValue: "+a+"="+b;if(c||(f+="? "+(e.code?e.description:"Echo:"+d)),e.code&&0!==e.code)try{window.dispatchEvent(new CustomEvent("REPORT_ERROR",{detail:{error:"Scorm Error",type:"SCORM",code:e.code,description:e.description,key:a,value:b}}))}catch(a){console.warn("Error reporting error: "+a)}return console.log(f),e.code}},Scorm.prototype.GetValue=function(a){if(this.active){var b;return"2004"==this.mode?b=this.scorm_interface.GetValue(a):"1.2"==this.mode&&(b=this.scorm_interface.LMSGetValue(a)),console.log("Scorm:GetValue: "+a+"="+b),b}},Scorm.prototype.Commit=function(){return(console.log("Scorm:Commit"),"2004"==this.mode)?this.scorm_interface.Commit(""):"1.2"==this.mode?this.scorm_interface.LMSCommit(""):void 0},Scorm.prototype.GetLearnerName=function(){if("2004"==this.mode)return this.GetValue("cmi.learner_name");return"1.2"==this.mode?this.GetValue("cmi.core.student_name"):void 0},Scorm.prototype.GetLearnerID=function(){if("2004"==this.mode)return this.GetValue("cmi.learner_id");return"1.2"==this.mode?this.GetValue("cmi.core.student_id"):void 0},Scorm.prototype.GetLocation=function(){if("2004"==this.mode)return this.GetValue("cmi.location");return"1.2"==this.mode?this.GetValue("cmi.core.lesson_location"):void 0},Scorm.prototype.SetLocation=function(a){if("2004"==this.mode)return this.SetValue("cmi.location",a);return"1.2"==this.mode?this.SetValue("cmi.core.lesson_location",a):void 0},Scorm.prototype.GetExit=function(){if("2004"==this.mode)return this.GetValue("cmi.exit");return"1.2"==this.mode?this.GetValue("cmi.core.exit"):void 0},Scorm.prototype.SetExit=function(a){if("2004"==this.mode)return this.SetValue("cmi.exit",a);return"1.2"==this.mode?this.SetValue("cmi.core.exit",a):void 0},Scorm.prototype.GetSuspendData=function(){return this.GetValue("cmi.suspend_data")},Scorm.prototype.SetSuspendData=function(a){this.SetValue("cmi.suspend_data",a),this.Commit()},Scorm.prototype.GetProgress=function(){if("2004"==this.mode)return this.GetValue("cmi.progress_measure")},Scorm.prototype.SetProgress=function(a){if("2004"==this.mode)return this.SetValue("cmi.progress_measure",a)},Scorm.prototype.GetCompletionThreshold=function(){return!("2004"!=this.mode)&&this.GetValue("cmi.completion_threshold")},Scorm.prototype.SetCompletionThreshold=function(a){"2004"==this.mode&&this.SetValue("cmi.completion_threshold",a)},Scorm.prototype.GetScoreThreshold=function(){return!("2004"!=this.mode)&&this.GetValue("cmi.progress_measure")},Scorm.prototype.SetScoreThreshold=function(a){"2004"==this.mode&&this.SetValue("cmi.scaled_passing_score",a)},Scorm.prototype.SetSessionTime=function(a){return(a||(a=new Date().getTime()-this.start_time),"2004"==this.mode)?this.SetValue("cmi.session_time",this._format_time(a),!0):"1.2"==this.mode?this.SetValue("cmi.core.session_time",this._format_time(a),!0):void 0},Scorm.prototype.GetTotalTime=function(){if("2004"==this.mode)return this.GetValue("cmi.total_time");return!("1.2"!=this.mode)&&this.GetValue("cmi.core.total_time")},Scorm.prototype.GetCompletionStatus=function(){if("2004"==this.mode)return this.GetValue("cmi.completion_status");if("1.2"==this.mode){var a=this.GetValue("cmi.core.lesson_status");return"passed"==a||"failed"==a?"completed":a}},Scorm.prototype.SetCompletionStatus=function(a){"2004"==this.mode?this.SetValue("cmi.completion_status",a):"1.2"==this.mode&&this.SetValue("cmi.core.lesson_status",a),this.Commit()},Scorm.prototype.GetResult=function(){if("2004"==this.mode)return this.GetValue("cmi.success_status");if("1.2"==this.mode){var a=this.GetValue("cmi.core.lesson_status");return"passed"==a||"failed"==a?a:"unknown"}},Scorm.prototype.SetResult=function(a){"2004"==this.mode?"passed"==a?this.SetValue("cmi.success_status","passed"):"failed"==a&&this.SetValue("cmi.success_status","failed"):"1.2"==this.mode&&("passed"==a?this.SetCompletionStatus("passed"):"failed"==a&&this.SetCompletionStatus("failed")),this.Commit()},Scorm.prototype.SetPassed=function(){this.SetResult("passed")},Scorm.prototype.SetFailed=function(){this.SetResult("failed")},Scorm.prototype.SetCompleted=function(){this.SetCompletionStatus("completed")},Scorm.prototype.SetIncomplete=function(){this.SetCompletionStatus("incomplete")},Scorm.prototype.SetScore=function(a,b,c){this.has_score=!0,"2004"==this.mode?(this.SetValue("cmi.score.raw",a),this.SetValue("cmi.score.scaled",1/c*a),this.SetValue("cmi.score.min",b),this.SetValue("cmi.score.max",c)):"1.2"==this.mode&&(this.SetValue("cmi.core.score.raw",a),this.SetValue("cmi.core.score.min",b),this.SetValue("cmi.core.score.max",c)),this.Commit()},Scorm.prototype.SetObjective=function(a,b,c,d,e,f){var g=this.objectives.indexOf(a);-1==g&&(g=this.objectives.length,this.SetValue("cmi.objectives."+g+".id",a),"2004"==this.mode&&this.SetValue("cmi.objectives."+g+".description",f),this.objectives.push(a),this.SetValue("cmi.objectives."+g+".score.min",d?d:0),this.SetValue("cmi.objectives."+g+".score.max",e?e:100)),this.SetValue("cmi.objectives."+g+".score.raw",c?c:0),"2004"==this.mode?(this.SetValue("cmi.objectives."+g+".completion_status","completed"),("passed"==b||"failed"==b)&&this.SetValue("cmi.objectives."+g+".success_status",b)):"passed"==b||"failed"==b?this.SetValue("cmi.objectives."+g+".status",b):this.SetValue("cmi.objectives."+g+".status","completed")},Scorm.prototype.SetInteraction=function(a,b,c,d,e,f,g,h){var i=this.interactions.indexOf(a),j="1.2"==this.mode;if(-1==i&&(i=this.interactions.length,this.SetValue("cmi.interactions."+i+".id",a,j),this.SetValue("cmi.interactions."+i+".objectives.0.id",b,j),"2004"==this.mode&&(this.SetValue("cmi.interactions."+i+".description",e),this.SetValue("cmi.interactions."+i+".type",f)),this.interactions.push(a)),d)if("2004"!=this.mode)this.SetValue("cmi.interactions."+i+".student_response",d,j);else if(f&&g){if(this.SetValue("cmi.interactions."+i+".learner_response",d),this.GetValue("cmi.interactions."+i+".learner_response")!=d&&(this.SetValue("cmi.interactions."+i+".learner_response","elucidaterror"),this.SetValue("cmi.interactions."+i+".learner_response",d),this.GetValue("cmi.interactions."+i+".learner_response")!=d)){var k=d.split("[,]").join("__");this.SetValue("cmi.interactions."+i+".learner_response",k)}this.SetValue("cmi.interactions."+i+".correct_responses.0.pattern",g),this.SetValue("cmi.interactions."+i+".weighting",h)}"neutral"==c?this.SetValue("cmi.interactions."+i+".result","neutral",j):"passed"==c||"completed"==c?this.SetValue("cmi.interactions."+i+".result","correct",j):"failed"==c&&("2004"==this.mode?this.SetValue("cmi.interactions."+i+".result","incorrect"):this.SetValue("cmi.interactions."+i+".result","wrong",j))},Scorm.prototype.GetLanguage=function(){var a=null;return"2004"==this.mode?a=this.GetValue("cmi.learner_preference.language"):"1.2"==this.mode&&(a=this.GetValue("cmi.student_preference.language")),a&&(a=a.toLowerCase().trim()),a},Scorm.prototype.SetLanguage=function(a){if("2004"==this.mode)return this.SetValue("cmi.learner_preference.language",a);return"1.2"==this.mode?this.SetValue("cmi.student_preference.language",a):void 0};
