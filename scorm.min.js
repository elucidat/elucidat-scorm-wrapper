/* Elucidat SCORM API wrapper - https://github.com/elucidat/eluciat-scorm-wrapper/ - Licensed under the MIT license - Copyright (c) 2013 Elucidat Ltd*/
var Debug_API=function(){};Debug_API.prototype.Initialize=function(){console.log("Debug_api:Initialize");return!0};Debug_API.prototype.Terminate=function(){console.log("Debug_api:Terminate");return!0};Debug_API.prototype.GetValue=function(a){console.log("Debug_api:GetValue: "+a);return"lms-not-present"};Debug_API.prototype.SetValue=function(a,b){console.log("Debug_api:SetValue: "+a+"="+b);return""};Debug_API.prototype.Commit=function(){console.log("Debug_api:Commit");return!0};
Debug_API.prototype.GetLastError=function(){console.log("Debug_api:GetLastError (0)");return 0};Debug_API.prototype.GetErrorString=function(a){console.log("Debug_api:GetErrorString: "+a);return"lms-not-present"};Debug_API.prototype.GetDiagnostic=function(a){console.log("Debug_api:GetDiagnostic: "+a);return"lms-not-present"};Debug_API.prototype.LMSInitialize=function(){console.log("Debug_api:LMSInitialize");return!0};
Debug_API.prototype.LMSTerminate=function(){console.log("Debug_api:LMSTerminate");return!0};Debug_API.prototype.LMSGetValue=function(a){console.log("Debug_api:LMSGetValue: "+a);return"lms-not-present"};Debug_API.prototype.LMSSetValue=function(a,b){console.log("Debug_api:LMSSetValue: "+a+"="+b);return""};Debug_API.prototype.LMSCommit=function(){console.log("Debug_api:LMSCommit");return!0};Debug_API.prototype.LMSGetLastError=function(){console.log("Debug_api:LMSGetLastError (0)");return 0};
Debug_API.prototype.LMSGetErrorString=function(a){console.log("Debug_api:LMSGetErrorString: "+a);return"lms-not-present"};Debug_API.prototype.LMSGetDiagnostic=function(a){console.log("Debug_api:LMSGetDiagnostic: "+a);return"lms-not-present"};
var Scorm=function(){this.mode=this.scorm_interface=null;this.active=!1;this.objectives=0;this.start_time=(new Date).getTime()/1E3;this.has_score=!1;this.pass_action="completed";this._search_for_api(window);null==this.scorm_interface?(this.mode="2004",console.log("LMS not present - Created SCORM "+this.mode+" Debug interface."),this.scorm_interface=new Debug_API):(this.mode="LMSCommit"in this.scorm_interface?"1.2":"2004",console.log("Found SCORM "+this.mode+" interface."))};
Scorm.prototype._get_session_time=function(a){function b(a,b){var c="0000"+new String(Math.round(a));return c.substr(c.length-b)}var c=(new Date).getTime()/1E3-this.start_time;if("2004"==a)return Math.round(c);a=Math.floor(c/3600);var c=c-3600*a,d=Math.floor(c/60),c=c-60*d;return b(a,4)+":"+b(d,2)+":"+b(c,2)};
Scorm.prototype._search_for_api=function(a){try{for(;null!=a&&null==this.scorm_interface;)a.API_1484_11?this.scorm_interface=a.API_1484_11:a.API&&(this.scorm_interface=a.API),null==a.opener||a.opener.closed||this._search_for_api(a.opener),a=a==a.parent?null:a.parent}catch(b){return null}};
Scorm.prototype.Check=function(){var a=0;"2004"==this.mode?(a=this.scorm_interface.GetLastError())&&console.log("Error ("+a+"): "+this.scorm_interface.GetErrorString(a)):"1.2"==this.mode&&(a=this.scorm_interface.LMSGetLastError())&&console.log("Error ("+a+"): "+this.scorm_interface.LMSGetErrorString(a));return a};
Scorm.prototype.Initialize=function(){console.log("Scorm:Initialize");"2004"==this.mode?this.scorm_interface.Initialize(""):"1.2"==this.mode&&this.scorm_interface.LMSInitialize("");0==this.Check()&&(this.active=!0);return this.active};Scorm.prototype.Terminate=function(){console.log("Scorm:Terminate");"2004"==this.mode?this.scorm_interface.Terminate(""):"1.2"==this.mode&&this.scorm_interface.LMSFinish("");0==this.Check()&&(this.active=!1)};
Scorm.prototype.Deactivate=function(){console.log("Scorm:Deactivate");this.active=!1};Scorm.prototype.SetValue=function(a,b){if(this.active)return console.log("Scorm:SetValue: "+a+"="+b),"2004"==this.mode?this.scorm_interface.SetValue(a,b):"1.2"==this.mode&&this.scorm_interface.LMSSetValue(a,b),this.Check();console.log("Scorm:SetValue: ("+a+") Ignored (LMS inactive)")};
Scorm.prototype.GetValue=function(a){if(this.active){console.log("Scorm:GetValue: "+a);if("2004"==this.mode)return this.scorm_interface.GetValue(a);if("1.2"==this.mode)return this.scorm_interface.LMSGetValue(a)}else console.log("Scorm:GetValue: ("+a+") Ignored (LMS inactive)")};Scorm.prototype.Commit=function(){console.log("Scorm:Commit");if("2004"==this.mode)return this.scorm_interface.Commit("");if("1.2"==this.mode)return this.scorm_interface.LMSCommit("")};
Scorm.prototype.GetLearnerName=function(){if("2004"==this.mode)return this.GetValue("cmi.learner_name");if("1.2"==this.mode)return this.GetValue("cmi.core.student_name")};Scorm.prototype.GetLocation=function(){if("2004"==this.mode)return this.GetValue("cmi.location");if("1.2"==this.mode)return this.GetValue("cmi.core.lesson_location")};
Scorm.prototype.SetLocation=function(a){if("2004"==this.mode)return this.SetValue("cmi.location",a);if("1.2"==this.mode)return this.SetValue("cmi.core.lesson_location",a)};Scorm.prototype.GetCompletionStatus=function(){if("2004"==this.mode)return this.GetValue("cmi.completion_status");if("1.2"==this.mode){var a=this.GetValue("cmi.core.lesson_status");return"passed"==a||"failed"==a?"completed":a}};
Scorm.prototype.SetCompletionStatus=function(a){if("2004"==this.mode)return this.SetValue("cmi.completion_status",a);if("1.2"==this.mode)return this.SetValue("cmi.core.lesson_status",a)};Scorm.prototype.GetOutcome=function(){if("2004"==this.mode)return this.GetValue("cmi.success_status");if("1.2"==this.mode){var a=this.GetValue("cmi.core.lesson_status");return"passed"==a||"failed"==a?a:"unknown"}};
Scorm.prototype.SetOutcome=function(a){"2004"==this.mode?(this.SetCompletionStatus("completed"),"passed"==a?this.SetValue("cmi.success_status","passed"):"failed"==a&&this.SetValue("cmi.success_status","failed"),this.SetValue("cmi.session_time",this._get_session_time("2004"))):"1.2"==this.mode&&(this.has_score&&"passed"==this.pass_action?"passed"==a?this.SetCompletionStatus("passed"):"failed"==a&&this.SetCompletionStatus("failed"):this.SetCompletionStatus("completed"),this.SetValue("cmi.core.session_time",
this._get_session_time("1.2")));this.Commit()};Scorm.prototype.Passed=function(){this.SetOutcome("passed")};Scorm.prototype.Failed=function(){this.SetOutcome("failed")};Scorm.prototype.SetScore=function(a,b,c){this.has_score=!0;"2004"==this.mode?(this.SetValue("cmi.score.raw",a),this.SetValue("cmi.score.min",b),this.SetValue("cmi.score.max",c)):"1.2"==this.mode&&(this.SetValue("cmi.core.score.raw",a),this.SetValue("cmi.core.score.min",b),this.SetValue("cmi.core.score.max",c))};
Scorm.prototype.SetObjective=function(a,b,c,d,e){this.SetValue("cmi.objectives."+this.objectives+".id",a);this.SetValue("cmi.objectives."+this.objectives+".status","passed"==b?"passed":"failed");this.SetValue("cmi.objectives."+this.objectives+".raw",c?c:0);this.SetValue("cmi.objectives."+this.objectives+".max",d?d:0);this.SetValue("cmi.objectives."+this.objectives+".min",e?e:100);"2004"==this.mode&&this.SetValue("cmi.objectives."+this.objectives+".completion_status","completed");this.objectives++};